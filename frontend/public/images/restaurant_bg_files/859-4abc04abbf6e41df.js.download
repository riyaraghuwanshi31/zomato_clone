"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[859],{1859:function(e,t,n){let o;n.d(t,{Z:function(){return $}});let a="login_ui",i="IFRAME",c="NEW_WINDOW",r="MODAL_TYPE_VISIBLE",s=()=>{w(),d()};var l,d,h,p,u,m,_=void 0;let g=(e,t)=>{var n=document.createElement("iframe");if(n.setAttribute("id","auth-login-ui"),n.setAttribute("src",t),n.setAttribute("sandbox","allow-top-navigation allow-scripts allow-popups allow-forms allow-same-origin"),n.style.alignItems="center",n.style.position="fixed",o=document.createElement("div"),_=n,e===r){n.style.top="50%",n.style.left="50%",n.style.transform="translate(-50%, -50%)",n.style.border="0",n.style.borderRadius="0.6rem",n.style.width="100vw",n.style.height="100vh",n.style.minHeight="150px",n.style.minWidth="300px",n.style.boxShadow="rgba(28, 28, 28, 0.15) 0px 1.2rem 7rem";var a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.opacity="0.8",a.style.top="0px",a.style.backgroundColor="black",a.onclick=s,o.style.width="100%",o.style.height="100%",o.style.border="100%",o.style.position="fixed",o.style.top=0,o.appendChild(a)}else n.style.width="0",n.style.height="0",n.style.visibility="hidden";o.appendChild(_),document.body.appendChild(o)},w=()=>{void 0!==o&&(o.remove(),o=void 0),void 0!==_.close&&_.close()},f=e=>{_=window.open(e);let t=setInterval(function(){_.closed&&(clearInterval(t),s())},50)};var y=n(9079);class v{setOAuthScreen(e){this.oauth_screen=e}setIdToken(e){this.id_token=e}setAccountsData(e,t){var n=["google","email","phone","akamai"];if("LOGIN_METHODS"==e){if(!Array.isArray(t))return;var o=[];for(let e of t)n.includes(e)&&o.push(e);0==o.length&&(o=["google","email","phone"]),this.accounts_data.LOGIN_METHODS=o}else this.accounts_data[e]=t}setLoginChallenge(e){this.login_challenge=e}setPnlHash(e){this.pnl_hash=e}setTheme(e){this.theme=e}constructor(){if(v._instance)return v._instance;v._instance=this,this.cookie_domain=".zomato.com",this.accounts_domain="https://accounts.zomato.com",this.google_cid=y.env.REACT_APP_GOOGLE_CID||y.env.NEXT_PUBLIC_GOOGLE_CID,this.accounts_data={LOGIN_TYPE:"login",LOGIN_METHODS:["google","email","phone"]}}}let b=function(e){var t=new V,n=new v,o=new Date,a="; expires="+new Date(o.getFullYear()+1,o.getMonth(),o.getDate()).toUTCString();t.redirect_url?document.cookie="cid="+(e||"")+a+";path=/":document.cookie="cid="+(e||"")+a+";domain="+n.cookie_domain+";path=/"},k=()=>{var e=new V;e.logout_url&&(document.cookie="cid=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;",fetch(e.logout_url,{method:"POST"}).then(e=>e.json()).then(function(e){e.status&&console.log(e.message)}).catch(e=>{console.log(e),console.error("logout failed")}))},P=e=>"; ".concat(document.cookie).split("; ".concat(e,"=")).pop().split(";").shift();function O(){x({ev:"errorFound"})}function T(){x({ev:"removeCookies"})}function D(){x({ev:"errorFound"})}let S=e=>null==e||0===e.length;function E(){var e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,e=>("0"+e.toString(16)).substr(-2)).join("")}async function L(e){var t;return t=await function(e){let t=new TextEncoder().encode(e);return window.crypto.subtle.digest("SHA-256",t)}(e),btoa(String.fromCharCode.apply(null,new Uint8Array(t))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function A(){var e=new v,t=new V;let n=e.accounts_domain+"/oauth2/auth";var o=E(),a=E(),i=await L(a),c=new URL(n);return c.searchParams.append("code_challenge",i),c.searchParams.append("code_challenge_method","S256"),c.searchParams.append("client_id",t.client_id),c.searchParams.append("redirect_uri",e.accounts_domain+"/zoauth/callback"),c.searchParams.append("scope",t.scope),c.searchParams.append("state",o),c.searchParams.append("response_type",t.response_type),e.setAccountsData("zxcv",a),e.setAccountsData("purl",top.window.location.origin),e.setAccountsData("cid",t.client_id),e.setAccountsData("curl",t.redirect_url),b(t.client_id),c.href}function C(e,t){return new Promise(async(n,o)=>{let s=await A();l=n,d=o,e===c?f(s):e===i&&(t===a?g(r,s):g("MODAL_TYPE_HIDDEN",s))})}var I=!1;let F=()=>{I&&(I=!1)},j=()=>void 0!==p?p("not able to logout"):void 0!==m?m("not able to refresh"):void 0!==d?d("not able to signin"):void 0;function x(e){var t=new v;t.oauth_screen==i?document.getElementById("auth-login-ui").contentWindow.postMessage(e,t.accounts_domain):_.postMessage(e,t.accounts_domain)}function M(e){if(e.data&&e.data.ev){var t=new v,n=JSON.parse(JSON.stringify(e.data));if(e.origin===t.accounts_domain)switch(n.ev){case"loginModalReady":I?z():G();break;case"getLoginConfigs":R();break;case"closeModalContainer":case"completeSignIn":l("able to sign in"),w();break;case"errorInSignIn":s();break;case"refreshDone":u();break;case"loggedOut":k(),h();break;case"errorFound":w(),j(),F();break;case"getAccountsData":x({ev:"accountsData",data:new v().accounts_data});break;case"completeConsent":!function(e){var t=new v().accounts_domain+"/consent";let n=new FormData;n.append("cc",e),fetch(t,{method:"POST",credentials:"include",body:n}).then(e=>e.json()).then(function(e){!0==e.status&&function(e){if(""===e)return console.info("Empty Redirect URL"),!1;try{var t=new v;if(new URL(e).origin!==t.accounts_domain)return!1}catch(e){return console.error("Exception",e),!1}return!0}(e.redirect_to)?x({ev:"redirectCallback",data:e.redirect_to}):O()}).catch(function(e){console.log(e),O()})}(n.data);break;case"completeCallback":!function(e,t,n){let o=new FormData;o.append("code",e),o.append("state",t),o.append("scope",n);var a=new V,i=new v().accounts_domain+"/callback";fetch(i,{method:"POST",credentials:"include",body:o}).then(e=>e.json()).then(function(e){if(e.status){if(e.data.opaque_token){let t=new URLSearchParams;t.append("token",e.data.opaque_token),a.redirect_url&&function(e){if(""===e)return console.info("Empty Callback URL"),!1;try{var t=new URL(e).origin;if(!/^(https|http):\/\/(.+)?(\.eks\.zdev\.net|\.zdev\.net|\.zomans\.com|\.zomatoweather\.com|\.weatherforindia\.com|\.zomatoxtreme\.com|\.liveweather\.co\.in)$/i.test(t))return!1}catch(e){return console.error("Exception",e),!1}return!0}(a.redirect_url)&&fetch(a.redirect_url,{method:"POST",body:t,credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","x-zomato-csrf-token":P("__Host-csrft")}}).then(e=>e.json()).then(function(e){e.status&&T()}).catch(e=>{console.log(e),D()})}else T()}else D()}).catch(function(e){console.log(e),D()})}(n.data.code,n.data.state,n.data.scope);break;case"setLoginChallenge":t.setLoginChallenge(n.lc)}}}let N=()=>{window.addEventListener("message",M,!1)},z=()=>{I&&x({ev:"migrate"})},G=()=>{var e=new v;void 0!==e.id_token&&x({ev:"idTokenForOneTap",ID_TOKEN:e.id_token})},R=()=>{x({ev:"themeAndLoginData",THEME:new v().theme})};function H(){var e=new v;google.accounts.id.initialize({client_id:e.google_cid,callback:U}),google.accounts.id.prompt()}let U=e=>{let{credential:t=""}=e;var n=new V,o=new v;return o.setIdToken(t),o.setOAuthScreen(i),C(i,"one_tap",n.client_id,n.scope,n.response_type)};function W(){return new Promise((e,t)=>{var n=new V,o=new v().accounts_domain+"/token/refresh";let a=new FormData;a.append("cid",n.client_id),a.append("callback",n.redirect_url),fetch(o,{method:"POST",credentials:"include",body:a}).then(e=>e.json()).then(function(o){if(o.status){if(o.data.opaque_token){let a=new URLSearchParams;a.append("token",o.data.opaque_token),n.redirect_url&&isValidCallback(n.redirect_url)&&fetch(n.redirect_url,{method:"POST",body:a,credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded","x-zomato-csrf-token":P("__Host-csrft")}}).then(e=>e.json()).then(function(n){n.status?e(n.message):t(n.message)}).catch(e=>{t(e)})}else e(o.message)}else t(o.message)}).catch(function(e){t(e)})})}function q(e){var t=P("ttaz");if(t&&1e3*parseInt(t)-Date.now()<36e5)return W(e)}async function B(){var e=new V;new v().setOAuthScreen(i),C(i,"custom_login",e.client_id,e.scope,e.response_type)}function J(e){document.getElementById("auth-login-ui").src=e}var Y=n(9079);class V{validate(){return new Promise(function(e,t){fetch(Y.env.REACT_APP_GW_DOMAIN+"/gw/internal/auth/validate",{method:"POST"}).then(t=>{e(t.json())}).catch(e=>{console.log(e),t(e)})})}login(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;var n=new v;return[i,c].includes(e)&&n.setOAuthScreen(e),C(e,t)}logout(){return new Promise((e,t)=>{var n=new V,o=new v().accounts_domain+"/signout";let a=new FormData;a.append("cid",n.client_id),fetch(o,{method:"POST",credentials:"include",body:a}).then(e=>e.json()).then(function(n){n.status?(k(),e(n.message)):t(n.message)}).catch(function(e){t(e)})})}refresh(){return W()}migrate(){var e,t;return e=new V,t=new v,I=!0,t.setOAuthScreen(i),C(i,"migration_flow",e.client_id,e.scope,e.response_type)}initiatePhoneLogin(e,t,n,o){return new Promise((a,i)=>{var c=new v;let r=c.accounts_domain+"/login/phone",s=new FormData;s.append("country_id",e),s.append("number",t),s.append("lc",c.login_challenge),s.append("type","initiate"),s.append("verification_type",n||"sms"),s.append("message_uuid",o||""),fetch(r,{method:"POST",body:s,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?a(e):i(e)})})}verifyPhoneLogin(e,t,n){return new Promise((o,a)=>{var i=new v;let c=i.accounts_domain+"/login/phone",r=new FormData;r.append("country_id",e),r.append("number",t),r.append("lc",i.login_challenge),r.append("type","verify"),r.append("otp",n),fetch(c,{method:"POST",body:r,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?([2,4].includes(e.login_case)?J(e.redirect_to):i.setPnlHash(e.hash),o(e)):a(e)})})}signupPhoneLogin(e,t){return new Promise((n,o)=>{var a=new v;let i=a.accounts_domain+"/login/phone",c=new FormData;c.append("hash",a.pnl_hash),c.append("lc",a.login_challenge),c.append("type","create_user"),c.append("name",e),c.append("email",t),fetch(i,{method:"POST",body:c,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(J(e.redirect_to),n(e)):o(e)})})}initiateEmailLogin(e){return new Promise((t,n)=>{var o=new v;let a=o.accounts_domain+"/login/email",i=new FormData;i.append("email",e),i.append("lc",o.login_challenge),i.append("type","initiate"),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?t(e):n(e)})})}verifyEmailLogin(e,t){return new Promise((n,o)=>{var a=new v;let i=a.accounts_domain+"/login/email",c=new FormData;c.append("email",e),c.append("lc",a.login_challenge),c.append("type","verify"),c.append("otp",t),fetch(i,{method:"POST",body:c,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(J(e.redirect_to),n(e)):o(e)})})}initiateEmailSignup(e,t){return new Promise((n,o)=>{var a=new v;let i=a.accounts_domain+"/login/email",c=new FormData;c.append("name",t),c.append("email",e),c.append("lc",a.login_challenge),c.append("type","signup"),fetch(i,{method:"POST",body:c,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?n(e):o(e)})})}linkPhoneLoginWithEmail(){return new Promise((e,t)=>{var n=new v;let o=n.accounts_domain+"/login/phone",a=new FormData;a.append("hash",n.pnl_hash),a.append("lc",n.login_challenge),a.append("type","send_login_link"),fetch(o,{method:"POST",body:a,credentials:"include"}).then(e=>e.json()).then(n=>{n.status?e(n):t(n)})})}verifyLinkPhoneLoginWithEmail(e){return new Promise((t,n)=>{var o=new v;let a=o.accounts_domain+"/login/phone",i=new FormData;i.append("hash",o.pnl_hash),i.append("lc",o.login_challenge),i.append("type","verify_otp_link"),i.append("otp",e),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(J(e.redirect_to),t(e)):n(e)})})}linkPhoneLoginWithGoogle(e){return new Promise((t,n)=>{var o=new v;let a=o.accounts_domain+"/login/phone",i=new FormData;i.append("hash",o.pnl_hash),i.append("lc",o.login_challenge),i.append("type","link"),i.append("id_token",e),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(J(e.redirect_to),t(e)):n(e)})})}linkPhoneLoginWithFacebook(e){return new Promise((t,n)=>{var o=new v;let a=o.accounts_domain+"/login/phone",i=new FormData;i.append("hash",o.pnl_hash),i.append("lc",o.login_challenge),i.append("type","link"),i.append("fb_token",e),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(J(e.redirect_to),t(e)):n(e)})})}customGoogleLogin(e){return new Promise((t,n)=>{var o=new v;let a=o.accounts_domain+"/login/google",i=new FormData;i.append("id_token",e),i.append("lc",o.login_challenge),i.append("type","social"),fetch(a,{method:"POST",body:i,credentials:"include"}).then(e=>e.json()).then(e=>{e.status?(J(e.redirect_to),t(e)):n(e)})})}closeAuthIframe(){s()}constructor(e={}){if(V._instance)return V._instance;V._instance=this,this.client_id=e.client_id,this.scope=e.scope||"offline",this.redirect_url=e.redirect_url||"",this.response_type="code",this.refresh_enable=e.refresh_enable||!0;var t,n=new v;if(void 0!==e.login_methods&&n.setAccountsData("LOGIN_METHODS",e.login_methods),this.logout_url=e.logout_url||"",!0===e.enable_one_tap){let e;(e=document.createElement("script")).setAttribute("src","https://accounts.google.com/gsi/client"),e.onload=H,document.body.appendChild(e)}void 0!==e.theme&&n.setTheme(e.theme),N(),!0===e.custom&&B(this.client_id,this.scope,this.response_type),!0===this.auto_refresh&&(q(this.client_id),setInterval(()=>q(this.client_id),18e5)),(t=P("lme"))&&"1"===t&&this.migrate().then(void(document.cookie="lme=; Path=/;Domain=.zdev.net; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"))}}var $=function(e){if(S(e.client_id)){console.error("client_id is required");return}return new V(e)}}}]);